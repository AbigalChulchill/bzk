{
  "clazz" : "net.bzk.flow.model.Flow",
  "uid" : "SSPBbWtmfHPV",
  "name" : "SUB-strategy-peak-bottleneck",
  "boxs" : [ {
    "clazz" : "net.bzk.flow.model.Box",
    "uid" : "MINMAX52of8",
    "name" : "MINMAX",
    "actions" : [ {
      "clazz" : "net.bzk.flow.model.Action$VarModifyAction",
      "uid" : "POnGmKqao8p1",
      "name" : "M_InitVars",
      "tryErrorble" : false,
      "enable" : true,
      "devBoxVars" : { },
      "devFlowVars" : { },
      "minLogLv" : "NONE",
      "flatData" : [ {
        "key" : "h5maInfo",
        "val" : "!javascript===\n$tsFunc.getLast(${ma.m5x60});"
      }, {
        "key" : "positionSide",
        "val" : "!javascript===\n$bzk.g('MACDtrender.trendInfo.state')== 'RISE' ? 'LONG':'SHORT';"
      } ]
    } ],
    "links" : [ {
      "clazz" : "net.bzk.flow.model.Link",
      "uid" : "Div2tmjgl8JG",
      "name" : "CheckNoAllow",
      "condition" : {
        "clazz" : "net.bzk.flow.model.Condition$ConditionCode",
        "kind" : "NONE",
        "next" : null,
        "polyglot" : "js",
        "code" : "const allowSymbols = ${bottleneck};\r\nconst sbl = '${symbol}';\r\n!allowSymbols.includes(sbl);"
      },
      "transition" : {
        "toBox" : "",
        "endTag" : "${symbol} NoAllow",
        "failEnd" : false,
        "endResultKeys" : [ ],
        "resultCode" : "{\n  \"ordered\": false,\n  \"breakName\": \"CheckNoAllow\"\n}"
      },
      "enable" : true
    }, {
      "clazz" : "net.bzk.flow.model.Link",
      "uid" : "B5FC1rRP7MUE",
      "name" : "PeakNear",
      "condition" : {
        "clazz" : "net.bzk.flow.model.Condition$ConditionNum",
        "kind" : "NONE",
        "next" : null,
        "left" : "${MACDtrender.trendInfo.nearPeak.dtime}\n",
        "right" : "500",
        "type" : "lessthan_equal"
      },
      "transition" : {
        "toBox" : "iQ07yoOBfiPS",
        "endTag" : null,
        "failEnd" : false,
        "endResultKeys" : [ {
          "lv" : "not_specify",
          "key" : "h8r1BiggerPeak.reverseResult"
        } ],
        "resultCode" : "{\n  \"ordered\": false,\n  \"breakName\": \"ReverseTooBig\"\n}"
      },
      "enable" : true
    }, {
      "clazz" : "net.bzk.flow.model.Link",
      "uid" : "oFQV3T3mrCu7",
      "name" : "crossNear",
      "condition" : {
        "clazz" : "net.bzk.flow.model.Condition$ConditionNum",
        "kind" : "NONE",
        "next" : null,
        "left" : "!javascript===\nconst lastVal = ${MACDtrender.last.val};\nconst exQuote = ${binanceQuote.all.avgPrice};\nconst ans = Math.abs( lastVal) / exQuote;\nans;",
        "right" : "0.0006",
        "type" : "lessthan_equal"
      },
      "transition" : {
        "toBox" : "y09CvF3tt03P",
        "endTag" : null,
        "failEnd" : false,
        "endResultKeys" : [ {
          "lv" : "not_specify",
          "key" : "h8r1BiggerPeak.trendInfo.nearPeak.dtime"
        } ],
        "resultCode" : "{\n  \"ordered\": false,\n  \"breakName\": \"PeakTooFar\"\n}"
      },
      "enable" : true
    } ],
    "vars" : { },
    "taskSort" : [ "Div2tmjgl8JG", "POnGmKqao8p1", "B5FC1rRP7MUE", "oFQV3T3mrCu7" ],
    "whileJudgment" : null,
    "transition" : {
      "toBox" : "",
      "endTag" : "${symbol} ${positionSide} IDLE",
      "failEnd" : false,
      "endResultKeys" : [ ],
      "resultCode" : "{\n  \"ordered\": false,\n  \"breakName\": \"IDLE\"\n}"
    },
    "minLogLv" : "DEBUG"
  }, {
    "clazz" : "net.bzk.flow.model.Box",
    "uid" : "y09CvF3tt03P",
    "name" : "CallOrderProfit",
    "actions" : [ {
      "clazz" : "net.bzk.flow.model.Action$SubFlowAction",
      "uid" : "tWrAJcQR5WgW",
      "name" : "ORDER_TAKE_PROFIT",
      "tryErrorble" : false,
      "enable" : true,
      "devBoxVars" : { },
      "devFlowVars" : { },
      "minLogLv" : "NONE",
      "flowUid" : "02eQyaMwyojZ",
      "asynced" : false,
      "inputData" : [ {
        "key" : "positionSide",
        "val" : "${positionSide}"
      }, {
        "key" : "symbol",
        "val" : "${symbol}"
      }, {
        "key" : "tags",
        "val" : "[\"bneck\"]"
      }, {
        "key" : "trigger",
        "val" : "bottleneck"
      }, {
        "key" : "size",
        "val" : "8"
      }, {
        "key" : "gapRate",
        "val" : "0.0025"
      }, {
        "key" : "priceBuffRate",
        "val" : "1.003"
      }, {
        "key" : "proportionalRate",
        "val" : "1.025"
      }, {
        "key" : "strategy",
        "val" : "TAKE_PROFIT"
      }, {
        "key" : "positionRate",
        "val" : "0.5"
      } ],
      "outputReflects" : [ ]
    }, {
      "clazz" : "net.bzk.flow.model.HttpAction",
      "uid" : "hM85UtkI5OS0",
      "name" : "CancelProfit",
      "tryErrorble" : false,
      "enable" : true,
      "devBoxVars" : { },
      "devFlowVars" : { },
      "minLogLv" : "NONE",
      "url" : "${finExManageApiUrl}",
      "uriVariables" : { },
      "body" : "{\n    \"symbol\": \"${symbol}\",\n    \"positionSide\": \"${positionSide}\",\n    \"status\":\"NEW\",\n    \"orderType\":\"TAKE_PROFIT\",\n    \"name\": \"order/delete_by_filter\",\n    \"exchange\": \"binance\",\n    \"__bzk_api_key\": \"${finExManageApiKey}\"\n}",
      "method" : "POST",
      "headers" : { },
      "headersFlat" : "",
      "key" : {
        "lv" : "not_specify",
        "key" : ""
      }
    } ],
    "links" : [ ],
    "vars" : { },
    "taskSort" : [ "hM85UtkI5OS0", "tWrAJcQR5WgW" ],
    "whileJudgment" : null,
    "transition" : {
      "toBox" : "",
      "endTag" : "${symbol} ${positionSide} LIMIT:${__pk_result.ordered} profit:true",
      "failEnd" : false,
      "endResultKeys" : [ ],
      "resultCode" : "{\r\n  \"limit\": ${__pk_result},\r\n  \"takeProfit\":{\r\n      \"ordered\":true\r\n  }\r\n}"
    },
    "minLogLv" : "DEBUG"
  }, {
    "clazz" : "net.bzk.flow.model.Box",
    "uid" : "iQ07yoOBfiPS",
    "name" : "CallOrderLIMIT",
    "actions" : [ {
      "clazz" : "net.bzk.flow.model.Action$SubFlowAction",
      "uid" : "3gcfLj4AEmmZ",
      "name" : "ORDER_LIMIT",
      "tryErrorble" : false,
      "enable" : true,
      "devBoxVars" : { },
      "devFlowVars" : { },
      "minLogLv" : "NONE",
      "flowUid" : "02eQyaMwyojZ",
      "asynced" : false,
      "inputData" : [ {
        "key" : "positionSide",
        "val" : "${positionSide}"
      }, {
        "key" : "symbol",
        "val" : "${symbol}"
      }, {
        "key" : "withdrawAmountRate",
        "val" : "0.2"
      }, {
        "key" : "tags",
        "val" : "[\"bneck\"]"
      }, {
        "key" : "trigger",
        "val" : "bottleneck"
      }, {
        "key" : "size",
        "val" : "10"
      }, {
        "key" : "gapRate",
        "val" : "0.0056"
      }, {
        "key" : "priceBuffRate",
        "val" : "1.001"
      }, {
        "key" : "proportionalRate",
        "val" : "1.286"
      }, {
        "key" : "strategy",
        "val" : "LIMIT"
      } ],
      "outputReflects" : [ ]
    }, {
      "clazz" : "net.bzk.flow.model.HttpAction",
      "uid" : "UtKNelqPvlEh",
      "name" : "CancelLIMIT",
      "tryErrorble" : false,
      "enable" : true,
      "devBoxVars" : { },
      "devFlowVars" : { },
      "minLogLv" : "NONE",
      "url" : "${finExManageApiUrl}",
      "uriVariables" : { },
      "body" : "{\r\n    \"symbol\": \"${symbol}\",\r\n    \"positionSide\": \"${positionSide}\",\r\n    \"status\":\"NEW\",\r\n    \"orderType\":\"LIMIT\",\r\n    \"name\": \"order/delete_by_filter\",\r\n    \"exchange\": \"binance\",\r\n    \"__bzk_api_key\": \"${finExManageApiKey}\"\r\n}",
      "method" : "POST",
      "headers" : { },
      "headersFlat" : "",
      "key" : {
        "lv" : "not_specify",
        "key" : ""
      }
    }, {
      "clazz" : "net.bzk.flow.model.HttpAction",
      "uid" : "MLu2PZ4XJZcQ",
      "name" : "CancelSTOP",
      "tryErrorble" : false,
      "enable" : true,
      "devBoxVars" : { },
      "devFlowVars" : { },
      "minLogLv" : "NONE",
      "url" : "${finExManageApiUrl}",
      "uriVariables" : { },
      "body" : "{\n    \"symbol\": \"${symbol}\",\n    \"positionSide\": \"${stopPositionSide}\",\n    \"status\":\"NEW\",\n    \"orderType\":\"STOP_MARKET\",\n    \"name\": \"order/delete_by_filter\",\n    \"exchange\": \"binance\",\n    \"__bzk_api_key\": \"${finExManageApiKey}\"\n}",
      "method" : "POST",
      "headers" : { },
      "headersFlat" : "",
      "key" : {
        "lv" : "not_specify",
        "key" : ""
      }
    }, {
      "clazz" : "net.bzk.flow.model.Action$VarModifyAction",
      "uid" : "kuYJgT4psWwq",
      "name" : "CLSVars",
      "tryErrorble" : false,
      "enable" : true,
      "devBoxVars" : { },
      "devFlowVars" : { },
      "minLogLv" : "NONE",
      "flatData" : [ {
        "key" : "stopPositionSide ",
        "val" : "const positionSide = '${positionSide}';\n\nfunction calcPositionSide(){\n    return positionSide == 'LONG' ? 'SHORT' : 'LONG';\n}\ncalcPositionSide();"
      } ]
    }, {
      "clazz" : "net.bzk.flow.model.Action$SubFlowAction",
      "uid" : "BL84Fj9g5LiH",
      "name" : "ORDER_STOP",
      "tryErrorble" : false,
      "enable" : true,
      "devBoxVars" : { },
      "devFlowVars" : { },
      "minLogLv" : "NONE",
      "flowUid" : "02eQyaMwyojZ",
      "asynced" : false,
      "inputData" : [ {
        "key" : "positionSide",
        "val" : "${stopPositionSide }"
      }, {
        "key" : "symbol",
        "val" : "${symbol}"
      }, {
        "key" : "tags",
        "val" : "TODO"
      }, {
        "key" : "trigger",
        "val" : "[\"bneck\"]"
      }, {
        "key" : "size",
        "val" : "8"
      }, {
        "key" : "gapRate",
        "val" : "0.0025"
      }, {
        "key" : "priceBuffRate",
        "val" : "1.001"
      }, {
        "key" : "proportionalRate",
        "val" : "1.3"
      }, {
        "key" : "strategy",
        "val" : "STOP_MARKET"
      }, {
        "key" : "positionRate",
        "val" : "0.5"
      } ],
      "outputReflects" : [ ]
    } ],
    "links" : [ ],
    "vars" : { },
    "taskSort" : [ "kuYJgT4psWwq", "UtKNelqPvlEh", "3gcfLj4AEmmZ", "MLu2PZ4XJZcQ", "BL84Fj9g5LiH" ],
    "whileJudgment" : null,
    "transition" : {
      "toBox" : "",
      "endTag" : "${symbol} ${positionSide} LIMIT:false  profit:false",
      "failEnd" : false,
      "endResultKeys" : [ ],
      "resultCode" : "{\n  \"ordered\": true,\n  \"breakName\": \"NONE\"\n}"
    },
    "minLogLv" : "DEBUG"
  } ],
  "varCfgNames" : [ "binance.json", "crypto-symbol.json", "fin-exchange-manage.json" ],
  "vars" : { },
  "entry" : {
    "clazz" : "net.bzk.flow.model.Entry$PluginEntry",
    "boxUid" : "MINMAX52of8",
    "autoRegister" : false,
    "requiredKeys" : [ "__ALL__" ],
    "outputKeys" : [ ]
  },
  "threadCfg" : {
    "corePoolSize" : 10,
    "maximumPoolSize" : 50,
    "keepAliveTime" : 500,
    "aliveUnit" : "MINUTES"
  },
  "version" : 170
}