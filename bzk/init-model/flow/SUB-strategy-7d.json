{
  "clazz" : "net.bzk.flow.model.Flow",
  "uid" : "C06bTWXsMh7D",
  "name" : "SUB-strategy-7d",
  "boxs" : [ {
    "clazz" : "net.bzk.flow.model.Box",
    "uid" : "UdfFblT52of8",
    "name" : "MIN_MAX",
    "actions" : [ {
      "clazz" : "net.bzk.flow.model.Action$VarModifyAction",
      "uid" : "POnGmKqao8p1",
      "name" : "MM_InitVars",
      "tryErrorble" : false,
      "enable" : true,
      "devBoxVars" : { },
      "devFlowVars" : { },
      "flatData" : [ {
        "key" : "toSellOrBuy",
        "val" : "!javascript===\r\nconst min = ${minmax.min};\r\nconst max = ${minmax.max};\r\n\r\nfunction calc(){\r\n    return min.dtime<max.dtime? \"BUY\" : \"SELL\";\r\n}\r\ncalc();"
      }, {
        "key" : "curMoveRate",
        "val" : "!javascript===\r\nconst exPrice = ${exPrice};\r\nconst nearPrice = ${minmax.near.val} + ${mean7d.val};\r\nconst dp = Math.abs( exPrice - nearPrice);\r\nconst ans= dp/nearPrice;\r\nans;"
      } ]
    } ],
    "links" : [ {
      "clazz" : "net.bzk.flow.model.Link",
      "uid" : "uQEGkV35pjX8",
      "name" : "TimeOver12H",
      "condition" : {
        "clazz" : "net.bzk.flow.model.Condition$ConditionNum",
        "kind" : "NONE",
        "next" : null,
        "left" : "${minmax.near.dtime}",
        "right" : "!javascript===\n60*60*12;",
        "type" : "greater_equal"
      },
      "transition" : {
        "toBox" : "",
        "endTag" : "END",
        "failEnd" : false,
        "endResultKeys" : [ {
          "lv" : "not_specify",
          "key" : "__ALL__"
        } ],
        "resultCode" : "TimeOver12H"
      },
      "enable" : true
    }, {
      "clazz" : "net.bzk.flow.model.Link",
      "uid" : "fwsKgL8JiZnq",
      "name" : "P_TH",
      "condition" : {
        "clazz" : "net.bzk.flow.model.Condition$ConditionNum",
        "kind" : "NONE",
        "next" : null,
        "left" : "!javascript===\nMath.abs( ${minmax.near.val});",
        "right" : "!javascript===\r\nMath.abs( ${minmax.far.val}) * 0.8 ;",
        "type" : "lessthan"
      },
      "transition" : {
        "toBox" : "",
        "endTag" : "END",
        "failEnd" : false,
        "endResultKeys" : [ {
          "lv" : "not_specify",
          "key" : "__ALL__"
        } ],
        "resultCode" : "P_TH"
      },
      "enable" : true
    }, {
      "clazz" : "net.bzk.flow.model.Link",
      "uid" : "wbxiE4C90UxL",
      "name" : "TimeLess30m",
      "condition" : {
        "clazz" : "net.bzk.flow.model.Condition$ConditionNum",
        "kind" : "NONE",
        "next" : null,
        "left" : "${minmax.near.dtime}",
        "right" : "!javascript===\r\n60*30;",
        "type" : "lessthan"
      },
      "transition" : {
        "toBox" : "",
        "endTag" : "END",
        "failEnd" : false,
        "endResultKeys" : [ {
          "lv" : "not_specify",
          "key" : "__ALL__"
        } ],
        "resultCode" : "TimeLess30m"
      },
      "enable" : true
    }, {
      "clazz" : "net.bzk.flow.model.Link",
      "uid" : "6q7K82sD3xWo",
      "name" : "OverMinOrMax",
      "condition" : {
        "clazz" : "net.bzk.flow.model.Condition$ConditionCode",
        "kind" : "NONE",
        "next" : null,
        "polyglot" : "js",
        "code" : "const toSellOrBuy='${toSellOrBuy}';\r\nconst exPrice = ${exPrice};\r\nconst nearPrice = ${minmax.near.val};\r\n\r\nfunction calc(){\r\n    if(toSellOrBuy == 'SELL'){\r\n        return exPrice > nearPrice;\r\n    }else{\r\n        return exPrice < nearPrice;\r\n    }\r\n}\r\ncalc();"
      },
      "transition" : {
        "toBox" : "",
        "endTag" : "END",
        "failEnd" : false,
        "endResultKeys" : [ {
          "lv" : "not_specify",
          "key" : "__ALL__"
        } ],
        "resultCode" : "OverMinOrMax"
      },
      "enable" : true
    }, {
      "clazz" : "net.bzk.flow.model.Link",
      "uid" : "dgKXFR8jH8x5",
      "name" : "ValueChangeOver",
      "condition" : {
        "clazz" : "net.bzk.flow.model.Condition$ConditionNum",
        "kind" : "NONE",
        "next" : null,
        "left" : "${curMoveRate}",
        "right" : "0.006",
        "type" : "greater_equal"
      },
      "transition" : {
        "toBox" : "",
        "endTag" : "END",
        "failEnd" : false,
        "endResultKeys" : [ {
          "lv" : "not_specify",
          "key" : "__ALL__"
        } ],
        "resultCode" : "ValueChangeOver"
      },
      "enable" : true
    } ],
    "vars" : { },
    "taskSort" : [ "POnGmKqao8p1", "uQEGkV35pjX8", "wbxiE4C90UxL", "fwsKgL8JiZnq", "6q7K82sD3xWo", "dgKXFR8jH8x5" ],
    "whileJudgment" : null,
    "transition" : {
      "toBox" : "iQ07yoOBfiPS",
      "endTag" : null,
      "failEnd" : false,
      "endResultKeys" : [ ],
      "resultCode" : "!javascript===\nconst side = ${toSellOrBuy};\nconst ans = {\n    side : side,\n    tag : \"MIN_MAX\"\n};\nans;"
    },
    "minLogLv" : "DEBUG"
  }, {
    "clazz" : "net.bzk.flow.model.Box",
    "uid" : "2yrIrBRsEZHo",
    "name" : "PrepareData",
    "actions" : [ {
      "clazz" : "net.bzk.flow.model.Action$SubFlowAction",
      "uid" : "TvxsY0dT0Zrd",
      "name" : "Fetch7DFixedBias",
      "tryErrorble" : false,
      "enable" : true,
      "devBoxVars" : { },
      "devFlowVars" : { },
      "flowUid" : "9RLQvpmbGa35",
      "asynced" : false,
      "inputData" : [ {
        "key" : "tsdbQuery",
        "val" : "import \"strings\"\r\na=  from(bucket: \"quote\")\r\n  |> range(start: -7d)\r\n   |> filter(fn: (r) =>\r\n    r._measurement == \"realtime\" and\r\n    r.symbol == \"${symbol}\" and\r\n    r._field == \"price\"\r\n  )\r\n  |>mean()\r\n  |> findColumn(\r\n      fn: (key) => key._field == \"price\",\r\n      column: \"_value\"\r\n    )\r\n\r\nfrom(bucket: \"quote\")\r\n  |> range(start: -7d)\r\n   |> filter(fn: (r) =>\r\n    r._measurement == \"realtime\" and\r\n    r.symbol == \"${symbol}\" and\r\n    r._field == \"price\"\r\n  )\r\n  |>map(fn: (r) => ({ r with _value: r._value - a[0] }))  "
      }, {
        "key" : "vaildMins",
        "val" : "10"
      }, {
        "key" : "skipCount",
        "val" : "0"
      } ],
      "outputReflects" : [ {
        "srcKey" : "nearVal",
        "toKey" : {
          "lv" : "not_specify",
          "key" : "D7FixedBias"
        }
      }, {
        "srcKey" : "trimValues",
        "toKey" : {
          "lv" : "not_specify",
          "key" : "D7FixedBiasSerial"
        }
      } ]
    }, {
      "clazz" : "net.bzk.flow.model.Action$VarModifyAction",
      "uid" : "i9QUdvKOUXPY",
      "name" : "analyzeVars",
      "tryErrorble" : false,
      "enable" : true,
      "devBoxVars" : { },
      "devFlowVars" : { },
      "flatData" : [ {
        "key" : "~minmax",
        "val" : "!javascript===\nconst mm = $tsFunc.minmax(${D7FixedBiasSerial});\nmm;"
      }, {
        "key" : "~peaks",
        "val" : "!javascript===\nconst peakMaxWaitSeconds = 60*60*1.5;\nconst mm = $tsFunc.findPeak(${D7FixedBiasSerial},0,peakMaxWaitSeconds,0.05);\nmm;"
      }, {
        "key" : "~conD",
        "val" : "!javascript===\r\nconst mm = $tsFunc.conD(${D7FixedBiasSerial},'UNIFORM_SLOPE',4);\r\nmm;"
      } ]
    }, {
      "clazz" : "net.bzk.flow.model.Action$VarModifyAction",
      "uid" : "0eatfgv9HoEq",
      "name" : "CalcVars",
      "tryErrorble" : false,
      "enable" : true,
      "devBoxVars" : { },
      "devFlowVars" : { },
      "flatData" : [ {
        "key" : "~lastInfo",
        "val" : "${peaks.last}"
      }, {
        "key" : "~lastPrice",
        "val" : "!javascript===\nconst mean = ${mean7d.val};\nconst lastv = ${peaks.last.val};\nmean + lastv;"
      }, {
        "key" : "~exPrice",
        "val" : "${exQuote.all.lastPrice}"
      } ]
    }, {
      "clazz" : "net.bzk.flow.model.HttpAction",
      "uid" : "IeJ9bGECoNPn",
      "name" : "BinanceQuote",
      "tryErrorble" : false,
      "enable" : true,
      "devBoxVars" : { },
      "devFlowVars" : { },
      "url" : "${binance.proxyHost}proxy",
      "uriVariables" : { },
      "body" : "{\r\n    \"name\":\"get_recent_trades_list\",\r\n    \"apiKey\":\"${binance.key}\",\r\n    \"secret\":\"${binance.secret}\",\r\n    \"symbol\":\"${symbol}\",\r\n    \"limit\":1000,\r\n    \"timeMaped\":true\r\n}",
      "method" : "POST",
      "headers" : { },
      "headersFlat" : "",
      "key" : {
        "lv" : "run_flow",
        "key" : "exQuote"
      }
    }, {
      "clazz" : "net.bzk.flow.model.Action$SubFlowAction",
      "uid" : "vfG3Fh5HNVce",
      "name" : "Fetch7Davg",
      "tryErrorble" : false,
      "enable" : true,
      "devBoxVars" : { },
      "devFlowVars" : { },
      "flowUid" : "9RLQvpmbGa35",
      "asynced" : false,
      "inputData" : [ {
        "key" : "tsdbQuery",
        "val" : "import \"strings\"\r\na=  from(bucket: \"quote\")\r\n  |> range(start: -7d)\r\n   |> filter(fn: (r) =>\r\n    r._measurement == \"realtime\" and\r\n    r.symbol == \"${symbol}\" and\r\n    r._field == \"price\"\r\n  )\r\n  |>mean()\r\n  |> findColumn(\r\n      fn: (key) => key._field == \"price\",\r\n      column: \"_value\"\r\n    )\r\n\r\nfrom(bucket: \"quote\")\r\n  |> range(start: -10m)\r\n   |> filter(fn: (r) =>\r\n    r._measurement == \"realtime\" and\r\n    r.symbol == \"${symbol}\" and\r\n    r._field == \"price\"\r\n  )\r\n  |>map(fn: (r) => ({ r with _value: a[0] }))  "
      }, {
        "key" : "vaildMins",
        "val" : "11"
      }, {
        "key" : "skipCount",
        "val" : "0"
      } ],
      "outputReflects" : [ {
        "srcKey" : "nearVal",
        "toKey" : {
          "lv" : "run_flow",
          "key" : "mean7d"
        }
      } ]
    } ],
    "links" : [ ],
    "vars" : {
      "symbol" : "BTC"
    },
    "taskSort" : [ "vfG3Fh5HNVce", "TvxsY0dT0Zrd", "IeJ9bGECoNPn", "i9QUdvKOUXPY", "0eatfgv9HoEq" ],
    "whileJudgment" : null,
    "transition" : {
      "toBox" : "UdfFblT52of8",
      "endTag" : null,
      "failEnd" : false,
      "endResultKeys" : [ ],
      "resultCode" : ""
    },
    "minLogLv" : "DEBUG"
  }, {
    "clazz" : "net.bzk.flow.model.Box",
    "uid" : "iQ07yoOBfiPS",
    "name" : "CallOrder",
    "actions" : [ {
      "clazz" : "net.bzk.flow.model.Action$SubFlowAction",
      "uid" : "3gcfLj4AEmmZ",
      "name" : "ORDER",
      "tryErrorble" : false,
      "enable" : true,
      "devBoxVars" : { },
      "devFlowVars" : { },
      "flowUid" : "02eQyaMwyojZ",
      "asynced" : false,
      "inputData" : [ {
        "key" : "side",
        "val" : "${__pk_result.side}"
      }, {
        "key" : "symbol",
        "val" : "${symbol}"
      }, {
        "key" : "investedRate",
        "val" : "0.005"
      }, {
        "key" : "guardRange",
        "val" : "0.005"
      }, {
        "key" : "currentMove",
        "val" : "0"
      }, {
        "key" : "tags",
        "val" : "[\"${__pk_result.tag}\"]"
      }, {
        "key" : "trigger",
        "val" : "${__pk_result.tag}"
      }, {
        "key" : "quoteSize",
        "val" : "5"
      }, {
        "key" : "quoteBase",
        "val" : "!javascript===\nconst dp = ${minmax.near.val};\nconst mean = ${mean7d.val};\nconst ans = mean + dp;\nans;"
      }, {
        "key" : "quoteRange",
        "val" : "0.03"
      } ],
      "outputReflects" : [ ]
    } ],
    "links" : [ ],
    "vars" : { },
    "taskSort" : [ "3gcfLj4AEmmZ" ],
    "whileJudgment" : null,
    "transition" : {
      "toBox" : "",
      "endTag" : "END",
      "failEnd" : false,
      "endResultKeys" : [ ],
      "resultCode" : ""
    },
    "minLogLv" : "DEBUG"
  } ],
  "varCfgNames" : [ "binance.json" ],
  "vars" : { },
  "entry" : {
    "clazz" : "net.bzk.flow.model.Entry$PluginEntry",
    "boxUid" : "2yrIrBRsEZHo",
    "autoRegister" : false,
    "requiredKeys" : [ "symbol" ],
    "outputKeys" : [ ]
  },
  "logEncryptKey" : "1234567890123456",
  "threadCfg" : {
    "corePoolSize" : 10,
    "maximumPoolSize" : 50,
    "keepAliveTime" : 500,
    "aliveUnit" : "MINUTES"
  }
}