{
  "clazz" : "net.bzk.flow.model.Flow",
  "uid" : "LlXZCvcaZsK8",
  "name" : "SellBuyUbinance",
  "boxs" : [ {
    "clazz" : "net.bzk.flow.model.Box",
    "uid" : "Hoh5CNTFiFDi",
    "name" : "SELL",
    "actions" : [ {
      "clazz" : "net.bzk.flow.model.Action$SubFlowAction",
      "uid" : "gsxIHdLoOV2I",
      "name" : "SellOrder",
      "tryErrorble" : false,
      "devBoxVars" : { },
      "devFlowVars" : { },
      "flowUid" : "kCmTvvaxfIBr",
      "asynced" : false,
      "inputData" : [ {
        "key" : "symbol",
        "val" : "${symbol}"
      }, {
        "key" : "side",
        "val" : "SELL"
      }, {
        "key" : "guardRate",
        "val" : "0"
      } ],
      "outputReflects" : [ ]
    } ],
    "links" : [ ],
    "vars" : { },
    "taskSort" : [ "gsxIHdLoOV2I" ],
    "whileJudgment" : null,
    "transition" : {
      "toBox" : "",
      "endTag" : "SELL_${acceleration.val}_${direction.last.val}_${direction.macro.state}",
      "failEnd" : false,
      "endResultKeys" : [ ]
    }
  }, {
    "clazz" : "net.bzk.flow.model.Box",
    "uid" : "vKSau3Y0hT1i",
    "name" : "Box",
    "actions" : [ {
      "clazz" : "net.bzk.flow.model.Action$SubFlowAction",
      "uid" : "KpH4PimCRDSe",
      "name" : "velocity_th",
      "tryErrorble" : false,
      "devBoxVars" : { },
      "devFlowVars" : { },
      "flowUid" : "9RLQvpmbGa35",
      "asynced" : false,
      "inputData" : [ {
        "key" : "tsdbQuery",
        "val" : "import \"math\"\r\nfrom(bucket: \"quote\")\r\n  |> range(start: -52h)\r\n  |> filter(fn: (r) =>\r\n    r._measurement == \"realtime\" and\r\n    r.symbol == \"${symbol}\" and\r\n    r._field == \"price\"\r\n  )\r\n  |> difference()\r\n  |> movingAverage(n: 144  )\r\n  |> movingAverage(n: 12  )\r\n  |>map(fn: (r) => ({ r with _value : math.abs(x: r._value) }))   \r\n  |> movingAverage(n: 432 )"
      }, {
        "key" : "vaildMins",
        "val" : "10"
      }, {
        "key" : "skipCount",
        "val" : "0"
      } ],
      "outputReflects" : [ {
        "srcKey" : "nearVal",
        "toKey" : {
          "lv" : "run_flow",
          "key" : "velocityTH"
        }
      } ]
    }, {
      "clazz" : "net.bzk.flow.model.Action$SubFlowAction",
      "uid" : "tDr8UTOVkNiO",
      "name" : "RiseOrFall",
      "tryErrorble" : false,
      "devBoxVars" : { },
      "devFlowVars" : { },
      "flowUid" : "PeakFinder5",
      "asynced" : false,
      "inputData" : [ {
        "key" : "tsdbQuery",
        "val" : "  from(bucket: \"quote\")\n  |> range(start: -7d)\n  |> filter(fn: (r) =>\n    r._measurement == \"realtime\" and\n    r.symbol == \"${symbol}\" and\n    r._field == \"price\"\n  )\n  |> difference()\n  |> movingAverage(n: 288  )\n  |> movingAverage(n: 12  )\n\n"
      }, {
        "key" : "peakMaxWaitSeconds",
        "val" : "3600"
      }, {
        "key" : "symbol",
        "val" : "${symbol}"
      }, {
        "key" : "macroAmplitudeRate",
        "val" : "0.368"
      } ],
      "outputReflects" : [ {
        "srcKey" : "ans",
        "toKey" : {
          "lv" : "run_flow",
          "key" : "direction"
        }
      } ]
    }, {
      "clazz" : "net.bzk.flow.model.Action$VarModifyAction",
      "uid" : "LtgQk1mGlHfR",
      "name" : "GenTarget",
      "tryErrorble" : false,
      "devBoxVars" : { },
      "devFlowVars" : { },
      "flatData" : [ {
        "key" : "~velocityThWeight",
        "val" : "!javascript===\nconst vb = ${volumeBias.val};\nconst curTH = ${direction.macro};\nconst r = Math.pow(2,vb);\nconst vTH = ${velocityTH.val} * r ;\n\n\nfunction calc(){\n    return {\n        \"SELL\": formula('SELL','nearMin'),\n        \"BUY\": formula('BUY','nearMax'),\n    };\n}\n\nfunction formula(side,vkey){\n    let n = curTH[vkey];\n    if(!n){\n        return side == 'BUY' ? -vTH : vTH;\n    }\n    let v =  n.val;\n    return -1 * (v /2) * r;\n}\n\ncalc();"
      }, {
        "key" : "~rapidReboundRate",
        "val" : "!javascript===\n\nconst th = ${velocityTH.val};\nconst a = ${acceleration.val};\nconst ans = a/th;\nans;"
      }, {
        "key" : "side",
        "val" : "!javascript===\nconst rrr = bzk.g('rapidReboundRate');\nconst th = bzk.g('velocityThWeight');\nconst lastv =  ${direction.last.val};\nconst macroState = '${direction.macro.state}';\nconst microState = '${direction.micro.state}';\n\nfunction clac(){\n    if(Math.abs( rrr)>=2) return rrr>0 ? 'BUY' : 'SELL';    \n    if(macroState!=microState) return 'NONE';\n    if(macroState == 'FALL' && lastv > th['SELL'] ) return 'SELL';\n    if(macroState == 'RISE' && lastv < th['BUY'] ) return 'BUY';\n    return 'NONE';\n}\nclac();"
      } ]
    }, {
      "clazz" : "net.bzk.flow.model.Action$SubFlowAction",
      "uid" : "4VSz2lcQQNbT",
      "name" : "BuyOrder",
      "tryErrorble" : false,
      "devBoxVars" : { },
      "devFlowVars" : { },
      "flowUid" : "kCmTvvaxfIBr",
      "asynced" : false,
      "inputData" : [ {
        "key" : "symbol",
        "val" : "${symbol}"
      }, {
        "key" : "side",
        "val" : "BUY"
      }, {
        "key" : "guardRate",
        "val" : "0"
      } ],
      "outputReflects" : [ ]
    }, {
      "clazz" : "net.bzk.flow.model.Action$SubFlowAction",
      "uid" : "brDCdhwwdBqn",
      "name" : "Acceleration",
      "tryErrorble" : false,
      "devBoxVars" : { },
      "devFlowVars" : { },
      "flowUid" : "9RLQvpmbGa35",
      "asynced" : false,
      "inputData" : [ {
        "key" : "tsdbQuery",
        "val" : "import \"strings\"\r\n\r\ntimedMovingSum = (every, period, column=\"_value\", tables=<-) =>\r\n  tables\r\n    |> window(every: every, period: period)\r\n    |> sum(column:column)\r\n    |> duplicate(column: \"_stop\", as: \"_time\")\r\n    |> window(every: inf)\r\n\r\nfrom(bucket: \"quote\")\r\n  |> range(start: -15h)\r\n  |> filter(fn: (r) =>\r\n    r._measurement == \"realtime\" and\r\n    r.symbol == \"${symbol}\" and\r\n    r._field == \"price\"\r\n  )\r\n  |> difference()\r\n  |> difference()\r\n  |>timedMovingSum(every: 5m, period: 1h)\r\n  |> movingAverage(n: 144  )"
      }, {
        "key" : "vaildMins",
        "val" : "10"
      }, {
        "key" : "skipCount",
        "val" : "1"
      } ],
      "outputReflects" : [ {
        "srcKey" : "nearVal",
        "toKey" : {
          "lv" : "run_flow",
          "key" : "acceleration"
        }
      } ]
    }, {
      "clazz" : "net.bzk.flow.model.Action$SubFlowAction",
      "uid" : "toNo8ZA1DBhY",
      "name" : "VolumeBias",
      "tryErrorble" : false,
      "devBoxVars" : { },
      "devFlowVars" : { },
      "flowUid" : "9RLQvpmbGa35",
      "asynced" : false,
      "inputData" : [ {
        "key" : "tsdbQuery",
        "val" : "import \"date\"\r\nimport \"math\"\r\n\r\navg12h = from(bucket: \"quote\")\r\n  |> range(start: -7d)\r\n  |> filter(fn: (r) =>\r\n    r._measurement == \"realtime\" and\r\n    r.symbol == \"${symbol}\" and\r\n    (r._field == \"volume_24h\" or r._field == \"price\")\r\n  )\r\n  |> map(fn: (r) => ({ r with _time: date.truncate(t: r._time, unit: 5m)    }))\r\n  |> pivot(rowKey:[\"_time\"], columnKey: [\"_field\"], valueColumn: \"_value\")\r\n  |> map(fn: (r) => ({ r with _value: r.volume_24h / r.price }))    \r\n  |> difference()\r\n  |>map(fn: (r) => ({ r with _value: math.abs(x: r._value)  }))   \r\n  |> mean()\r\n  |> findColumn(\r\n    fn: (key) => true,\r\n    column: \"_value\"\r\n  )  \r\n\r\n\r\nfrom(bucket: \"quote\")\r\n  |> range(start: -3h)\r\n  |> filter(fn: (r) =>\r\n    r._measurement == \"realtime\" and\r\n    r.symbol == \"${symbol}\" and\r\n    (r._field == \"volume_24h\" or r._field == \"price\")\r\n  )\r\n  |> map(fn: (r) => ({ r with _time: date.truncate(t: r._time, unit: 5m)    }))\r\n  |> pivot(rowKey:[\"_time\"], columnKey: [\"_field\"], valueColumn: \"_value\")\r\n  |> map(fn: (r) => ({ r with _value: r.volume_24h / r.price }))    \r\n  |> difference()\r\n  |> movingAverage(n: 24  )\r\n  |>map(fn: (r) => ({ r with _value: (r._value / avg12h[0])   }))   \r\n "
      }, {
        "key" : "vaildMins",
        "val" : "10"
      }, {
        "key" : "skipCount",
        "val" : "0"
      } ],
      "outputReflects" : [ {
        "srcKey" : "nearVal",
        "toKey" : {
          "lv" : "run_flow",
          "key" : "volumeBias"
        }
      } ]
    } ],
    "links" : [ {
      "clazz" : "net.bzk.flow.model.Link",
      "uid" : "BXX48Illzys2",
      "name" : "SELLCheck",
      "condition" : {
        "clazz" : "net.bzk.flow.model.Condition$ConditionTxt",
        "kind" : "NONE",
        "next" : null,
        "left" : "${side}",
        "right" : "SELL",
        "not" : false,
        "type" : "equal"
      },
      "transition" : {
        "toBox" : "Hoh5CNTFiFDi",
        "endTag" : null,
        "failEnd" : false,
        "endResultKeys" : [ ]
      }
    }, {
      "clazz" : "net.bzk.flow.model.Link",
      "uid" : "tl455y47pObG",
      "name" : "NONE",
      "condition" : {
        "clazz" : "net.bzk.flow.model.Condition$ConditionTxt",
        "kind" : "NONE",
        "next" : null,
        "left" : "${side}",
        "right" : "NONE",
        "not" : false,
        "type" : "equal"
      },
      "transition" : {
        "toBox" : "",
        "endTag" : "NONE_${acceleration.val}_${direction.last.val}_${direction.macro.state}",
        "failEnd" : false,
        "endResultKeys" : [ ]
      }
    } ],
    "vars" : { },
    "taskSort" : [ "KpH4PimCRDSe", "tDr8UTOVkNiO", "toNo8ZA1DBhY", "brDCdhwwdBqn", "LtgQk1mGlHfR", "tl455y47pObG", "BXX48Illzys2", "4VSz2lcQQNbT" ],
    "whileJudgment" : null,
    "transition" : {
      "toBox" : "",
      "endTag" : "BUY_${acceleration.val}_${direction.last.val}_${direction.macro.state}",
      "failEnd" : false,
      "endResultKeys" : [ ]
    }
  } ],
  "varCfgNames" : [ ],
  "vars" : {
    "symbol" : "BTC"
  },
  "entry" : {
    "clazz" : "net.bzk.flow.model.Entry$PluginEntry",
    "boxUid" : "vKSau3Y0hT1i",
    "autoRegister" : false,
    "requiredKeys" : [ "symbol" ],
    "outputKeys" : [ ]
  },
  "logEncryptKey" : "1234567890123456",
  "threadCfg" : {
    "corePoolSize" : 10,
    "maximumPoolSize" : 50,
    "keepAliveTime" : 500,
    "aliveUnit" : "MINUTES"
  }
}